"use strict";!function(o){o.module("application",["ngRoute"]).constant("applicationSettings",{applicationTitle:"Roomy",getFirebaseRestUrl:function(o){return"https://confdeconflictor.firebaseio.com/"+o+".json"},getImagePath:function(o){return"www/assets/images/${file}"}}).config(["$locationProvider","$routeProvider",function(o,t){o.html5Mode(!0),t.when("/login",{templateUrl:"www/app/routes/loginpage/loginpage.htm"}).when("/room/:id",{resolve:{isLoggedIn:["loginService",function(o){return!!o.isLoggedIn()||$location.path("/welcome")}]},template:"<r-room></r-room>"}).when("/welcome",{templateUrl:"www/app/routes/welcome/welcome.htm"}).otherwise({redirectTo:"/welcome"})}])}(window.angular),function(o){o.module("application").service("loginService",["$rootScope",function(o){function t(o){console.log("updateLogInStatus triggered"),console.log("authenticatedUser is: ",o),console.log("notifyControllerCallback is: ",s),a=o}function e(){return console.log("loggedInUser is: ",a),a}function n(){return firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider)}function i(){return firebase.auth().signOut()}function r(){return Boolean(a)}function l(){return a?a.displayName.split(" ")[0]:""}this.login=n,this.logout=i,this.isLoggedIn=r,this.getLoggedInUser=e,this.getFirstName=l;var a=null,s=null;firebase.auth().onAuthStateChanged(t)}])}(window.angular),function(o){o.module("application").factory("navigationService",function(){function o(){return n}function t(o){n||(n=[]),n.push(o)}function e(o){n.forEach(function(t,e){t.id===o.id&&n.splice(e,1)})}return{getNavigation:o,addNavigationItem:t,removeNavigationItem:e};var n})}(window.angular),function(o){o.module("application").factory("roomService",["$http","applicationSettings",function(t,e){function n(){return console.log("getRooms is: ",n),s}function i(o){return t.get(e.getFirebaseRestUrl("rooms/${id}")).then(function(o){return o.data}).then(function(t){return t.id=o,t})}function r(){return t.get(e.getFirebaseRestUrl("rooms")).then(function(o){return o.data}).then(function(t){return o.forEach(t,function(o,t){o.id=t,console.log("Room updated during fetch",o)}),t})}function l(o,n){return i(o).then(function(i){return t.post(e.getFirebaseRestUrl("rooms/"+o+"/reservations/"+a()),n)})}function a(o){var t=void 0;return t=o?new Date(o).toDateString():(new Date).toDateString(),t=t.replace(/ /g,"")}return{getRooms:n,getRoomById:i,fetchRoomsFromDB:r,writeRoomReservation:l};var s}])}(window.angular),function(o){o.module("application").controller("exerciseOneController",["$routeParams","es",function(o,t){this.es=t}])}(window.angular),function(o){o.module("application").controller("exerciseTwoController",["$routeParams","es",function(o,t){function e(){return n[Math.floor(Math.random()*n.length)]}this.es=t,this.title="Exercise 2";var n=[{name:"Brown",hex:"#A52A2A"},{name:"Blue",hex:"#0000FF"},{name:"Gainsboro",hex:"#DCDCDC"}];this.objectArray=[],this._createObject=function(){return{name:"Obj"+(this.objectArray.length+1),clickCount:0,color:e()}},this.controllerInitObject=this.objectArray,this.addNewObject=function(){this.objectArray.push(this._createObject())};this.buttonText="Button text",this.buttonMouseEnter=function(){this.buttonText="Rolled over"},this.buttonResetClick=function(){this.buttonText="Button text"}}])}(window.angular),function(o){o.module("application").component("gwLogin",{templateUrl:"www/app/components/login/login.htm",controller:"loginComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("loginComponentController",["loginService","$scope",function(o,t){this.loginService=o}])}(window.angular),function(o){o.module("application").component("navigation",{templateUrl:"www/app/components/navigation/navigation.html",controller:"navigationController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("navigationController",["$location","loginService","navigationService","roomService","$scope",function(t,e,n,i,r){this.$onInit=function(){function r(o){return o===t.path()}this.loginService=e,this.navigationService=n,this.roomService=i,this.isItemActive=r;var l={title:"Welcome",url:"/welcome"};n.addNavigationItem(l),i.fetchRoomsFromDB().then(function(t){console.log(t),o.forEach(t,function(o,t){var e={title:o.name,url:"/room/"+t};n.addNavigationItem(e)})})}}])}(window.angular),function(o){o.module("application").component("rRoom",{templateUrl:"www/app/components/rooms/room.htm",controller:"roomComponentController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("roomComponentController",["roomService",function(o){this.$onInit=function(){this.roomService=o,this.startTime=new Date,this.startTime.setHours(0,0,0,0),this.endTime=new Date,this.endTime.setHours(0,0,0,0),this.reserveReasons=["Birthday","Conference","Interview","Scrum Meeting","Honeymoon"],this.master={}},this.roomSubmission=function(){return console.log("start",this.startTime),console.log("end",this.endTime),this.startTime>=this.endTime?alert("Message from controller: time invalid"):this.myForm.$invalid?alert("Message from controller: form invalid"):(o.writeRoomReservation(),void alert("Room submitted"))}}])}(window.angular),function(o){o.module("application").controller("roomsController",["loginService",function(o){this.loginService=o}])}(window.angular),function(o){o.module("application").component("rRoomReservationForm",{templateUrl:"www/app/components/rooms/room-reservation-form/room-reservation-form.htm",controller:"roomReservationFormController",controllerAs:"ctrl",require:{parentController:"^rRoom"}})}(window.angular),function(o){o.module("application").controller("roomReservationFormController",["roomService",function(o){this.$onInit=function(){this.roomService=o,this.startTime=new Date,this.startTime.setHours(0,0,0,0),this.endTime=new Date,this.endTime.setHours(0,0,0,0),this.reserveReasons=["Birthday","Conference","Interview","Scrum Meeting","Honeymoon"],this.master={}},this.roomSubmission=function(){return console.log("start",this.startTime),console.log("end",this.endTime),console.log("this is: ",this),console.log("this.room is: ",this.room),console.log(this.myForm),this.startTime>=this.endTime?alert("Message from controller: time invalid"):this.myForm.$invalid?alert("Message from controller: form invalid"):void alert("Room submitted")}}])}(window.angular),function(o){o.module("application").component("rRoomReservationList",{templateUrl:"www/app/components/rooms/room-reservation-list/room-reservation-list.htm",controller:"roomReservationListController",controllerAs:"ctrl"})}(window.angular),function(o){o.module("application").controller("roomReservationListController",function(){})}(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5taW4uanMiLCJpbmRleC5qcyIsImNvbXBvbmVudHMvbG9naW4vbG9naW4uc2VydmljZS5qcyIsImNvbXBvbmVudHMvbmF2aWdhdGlvbi9uYXZpZ2F0aW9uLnNlcnZpY2UuanMiLCJjb21wb25lbnRzL3Jvb21zL3Jvb20uc2VydmljZS5qcyIsImNvbnRyb2xsZXJzL2V4ZXJjaXNlT25lQ29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2V4ZXJjaXNlVHdvQ29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvbG9naW4vbG9naW4uY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9sb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9uYXZpZ2F0aW9uL25hdmlnYXRpb24uY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9uYXZpZ2F0aW9uL25hdmlnYXRpb24uY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvcm9vbXMvcm9vbS5jb21wb25lbnQuanMiLCJjb21wb25lbnRzL3Jvb21zL3Jvb20uY29udHJvbGxlci5qcyIsInJvdXRlcy9yb29tcy9yb29tcy5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9yb29tcy9yb29tLXJlc2VydmF0aW9uLWZvcm0vcm9vbS1yZXNlcnZhdGlvbi1mb3JtLmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvcm9vbXMvcm9vbS1yZXNlcnZhdGlvbi1mb3JtL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9yb29tcy9yb29tLXJlc2VydmF0aW9uLWxpc3Qvcm9vbS1yZXNlcnZhdGlvbi1saXN0LmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvcm9vbXMvcm9vbS1yZXNlcnZhdGlvbi1saXN0L3Jvb20tcmVzZXJ2YXRpb24tbGlzdC5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsImFwcGxpY2F0aW9uVGl0bGUiLCJnZXRGaXJlYmFzZVJlc3RVcmwiLCJzdWZmaXgiLCJnZXRJbWFnZVBhdGgiLCJmaWxlIiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsImh0bWw1TW9kZSIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInJlc29sdmUiLCJpc0xvZ2dlZEluIiwibG9naW5TZXJ2aWNlIiwiJGxvY2F0aW9uIiwicGF0aCIsInRlbXBsYXRlIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsIndpbmRvdyIsInNlcnZpY2UiLCIkcm9vdFNjb3BlIiwidXBkYXRlTG9nSW5TdGF0dXMiLCJhdXRoZW50aWNhdGVkVXNlciIsImNvbnNvbGUiLCJsb2ciLCJub3RpZnlDb250cm9sbGVyQ2FsbGJhY2siLCJsb2dnZWRJblVzZXIiLCJfZ2V0TG9nZ2VkSW5Vc2VyIiwiX2xvZ2luIiwiZmlyZWJhc2UiLCJhdXRoIiwic2lnbkluV2l0aFBvcHVwIiwiR2l0aHViQXV0aFByb3ZpZGVyIiwiX2xvZ291dCIsInNpZ25PdXQiLCJfaXNMb2dnZWRJbiIsIkJvb2xlYW4iLCJfZ2V0Rmlyc3ROYW1lIiwiZGlzcGxheU5hbWUiLCJzcGxpdCIsInRoaXMiLCJsb2dpbiIsImxvZ291dCIsImdldExvZ2dlZEluVXNlciIsImdldEZpcnN0TmFtZSIsIm9uQXV0aFN0YXRlQ2hhbmdlZCIsImZhY3RvcnkiLCJnZXROYXZpZ2F0aW9uIiwibmF2aWdhdGlvbkl0ZW1zIiwiYWRkTmF2aWdhdGlvbkl0ZW0iLCJpdGVtIiwicHVzaCIsInJlbW92ZU5hdmlnYXRpb25JdGVtIiwiZm9yRWFjaCIsIml0ZW1Jbk5hdmlnYXRpb24iLCJpbmRleCIsImlkIiwic3BsaWNlIiwiJGh0dHAiLCJhcHBsaWNhdGlvblNldHRpbmdzIiwiZ2V0Um9vbXMiLCJyb29tcyIsImdldFJvb21CeUlkIiwiZ2V0IiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsImZldGNoUm9vbXNGcm9tREIiLCJ2YWx1ZSIsImtleSIsIndyaXRlUm9vbVJlc2VydmF0aW9uIiwicmVzZXJ2YXRpb24iLCJyb29tIiwicG9zdCIsImdldFJvb21EYXRlS2V5IiwiZGF0ZSIsImRhdGVLZXkiLCJEYXRlIiwidG9EYXRlU3RyaW5nIiwicmVwbGFjZSIsImNvbnRyb2xsZXIiLCIkcm91dGVQYXJhbXMiLCJlcyIsIl9nZXRSYW5kb21Db2xvckZyb21Db2xsZWN0aW9uIiwiX3Bvc3NpYmxlQ29sb3JzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwidGl0bGUiLCJuYW1lIiwiaGV4Iiwib2JqZWN0QXJyYXkiLCJfY3JlYXRlT2JqZWN0IiwiY2xpY2tDb3VudCIsImNvbG9yIiwiY29udHJvbGxlckluaXRPYmplY3QiLCJhZGROZXdPYmplY3QiLCJidXR0b25UZXh0IiwiYnV0dG9uTW91c2VFbnRlciIsImJ1dHRvblJlc2V0Q2xpY2siLCJjb21wb25lbnQiLCJjb250cm9sbGVyQXMiLCIkc2NvcGUiLCJuYXZpZ2F0aW9uU2VydmljZSIsInJvb21TZXJ2aWNlIiwiJG9uSW5pdCIsImlzSXRlbUFjdGl2ZSIsInZpZXdMb2NhdGlvbiIsIndlbGNvbWVJdGVtIiwidXJsIiwib2JqZWN0VmFsdWUiLCJvYmplY3RLZXkiLCJpdGVtVG9BZGQiLCJzdGFydFRpbWUiLCJzZXRIb3VycyIsImVuZFRpbWUiLCJyZXNlcnZlUmVhc29ucyIsIm1hc3RlciIsInJvb21TdWJtaXNzaW9uIiwiYWxlcnQiLCJteUZvcm0iLCIkaW52YWxpZCIsInJlcXVpcmUiLCJwYXJlbnRDb250cm9sbGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxjQ0FFLFNBQVNBLEdBQ1ZBLEVBQ0VDLE9BQU8sZUFBZ0IsWUFFdkJDLFNBQVMsdUJBQ1RDLGlCQUFtQixRQUVuQkMsbUJBQXFCLFNBQVNDLEdBSTdCLE1BSGUsMkNBR0NBLEVBRkosU0FLYkMsYUFBZSxTQUFTQyxHQUN2QixNQUFPLCtCQUlSQyxRQUFBQSxvQkFBQUEsaUJBQU8sU0FBU0MsRUFBbUJDLEdBQ25DRCxFQUFrQkUsV0FBVSxHQUU1QkQsRUFDR0UsS0FBSyxVQUNMQyxZQUFp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S2dDLE1BS25DakQsUUFBUUMsSUFBSWdCLEtBQUtpRixRQUViakYsS0FBSzBFLFdBQWExRSxLQUFLNEUsUUFBZ0JJLE1BQU0seUNBRTdDaEYsS0FBS2lGLE9BQU9DLFNBQWlCRixNQUFNLDZDQUV2Q0EsT0FBTSx1QkFHcEJ0RyxPQUFPdEIsU0M5Q1AsU0FBU0EsR0FDVEEsRUFDR0MsT0FBTyxlQUNQd0csVUFBVSx3QkFDVDVGLFlBQWEsMkVBQ2J1RSxXQUFZLGdDQUNac0IsYUFBYyxVQUVsQnBGLE9BQU90QixTQ1JSLFNBQVVBLEdBQ1BBLEVBQ0tDLE9BQU8sZUFFUG1GLFdBQVcsZ0NBQWlDLGVBR25EOUQsT0FBT3RCIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG5cdGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIiwgW1wibmdSb3V0ZVwiXSkuY29uc3RhbnQoXCJhcHBsaWNhdGlvblNldHRpbmdzXCIsIHtcblx0XHRhcHBsaWNhdGlvblRpdGxlOiBcIlJvb215XCIsXG5cblx0XHRnZXRGaXJlYmFzZVJlc3RVcmw6IGZ1bmN0aW9uIGdldEZpcmViYXNlUmVzdFVybChzdWZmaXgpIHtcblx0XHRcdHZhciBwcmVmaXggPSBcImh0dHBzOi8vY29uZmRlY29uZmxpY3Rvci5maXJlYmFzZWlvLmNvbS9cIjtcblx0XHRcdHZhciBleHQgPSBcIi5qc29uXCI7XG5cblx0XHRcdHJldHVybiBwcmVmaXggKyBzdWZmaXggKyBleHQ7XG5cdFx0fSxcblxuXHRcdGdldEltYWdlUGF0aDogZnVuY3Rpb24gZ2V0SW1hZ2VQYXRoKGZpbGUpIHtcblx0XHRcdHJldHVybiBcInd3dy9hc3NldHMvaW1hZ2VzLyR7ZmlsZX1cIjtcblx0XHR9XG5cdH0pLmNvbmZpZyhmdW5jdGlvbiAoJGxvY2F0aW9uUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyKSB7XG5cdFx0JGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG5cdFx0JHJvdXRlUHJvdmlkZXIud2hlbihcIi9sb2dpblwiLCB7XG5cdFx0XHR0ZW1wbGF0ZVVybDogJ3d3dy9hcHAvcm91dGVzL2xvZ2lucGFnZS9sb2dpbnBhZ2UuaHRtJ1xuXHRcdH0pLndoZW4oXCIvcm9vbS86aWRcIiwge1xuXHRcdFx0cmVzb2x2ZToge1xuXHRcdFx0XHRpc0xvZ2dlZEluOiBmdW5jdGlvbiBpc0xvZ2dlZEluKGxvZ2luU2VydmljZSkge1xuXHRcdFx0XHRcdHJldHVybiAhbG9naW5TZXJ2aWNlLmlzTG9nZ2VkSW4oKSA/ICRsb2NhdGlvbi5wYXRoKFwiL3dlbGNvbWVcIikgOiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0dGVtcGxhdGU6ICc8ci1yb29tPjwvci1yb29tPidcblx0XHR9KS53aGVuKFwiL3dlbGNvbWVcIiwge1xuXHRcdFx0dGVtcGxhdGVVcmw6ICd3d3cvYXBwL3JvdXRlcy93ZWxjb21lL3dlbGNvbWUuaHRtJ1xuXHRcdH0pLm90aGVyd2lzZSh7XG5cdFx0XHRyZWRpcmVjdFRvOiBcIi93ZWxjb21lXCJcblx0XHR9KTtcblx0fSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLnNlcnZpY2UoXCJsb2dpblNlcnZpY2VcIiwgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcbiAgICAgICAgICAgIC8vIHB1YmxpYyBBUElcbiAgICAgICAgICAgIHRoaXMubG9naW4gPSBfbG9naW47XG4gICAgICAgICAgICB0aGlzLmxvZ291dCA9IF9sb2dvdXQ7XG4gICAgICAgICAgICB0aGlzLmlzTG9nZ2VkSW4gPSBfaXNMb2dnZWRJbjtcbiAgICAgICAgICAgIHRoaXMuZ2V0TG9nZ2VkSW5Vc2VyID0gX2dldExvZ2dlZEluVXNlcjtcbiAgICAgICAgICAgIHRoaXMuZ2V0Rmlyc3ROYW1lID0gX2dldEZpcnN0TmFtZTtcblxuICAgICAgICAgICAgdmFyIGxvZ2dlZEluVXNlciA9IG51bGw7XG4gICAgICAgICAgICB2YXIgbm90aWZ5Q29udHJvbGxlckNhbGxiYWNrID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gRk9STSBDUkVBVElPTiBBTkQgVkFMSURBVElPTiBJTlNUUlVDVElPTlNcbiAgICAgICAgICAgIC8vIHlvdSBtdXN0IG5hbWUgYSBmb3JtIGZvciBhbmd1bGFyIHRvIHJlY29nbml6ZSBpdCA8Zm9ybSBuYW1lPVwibXlGb3JtXCIgLi4uPlxuICAgICAgICAgICAgLy8geW91IG11c3QgYWxzbyBpbmNsdWRlIFwibm92YWxpZGF0ZVwiLiB0aGlzIHR1cm5zIG9mZiB5b3VyIGJyb3dzZXIncyB2YWxpZGF0aW9uLiBpdCB3aWxsIGNvbmZsaWN0IHdpdGggYW5ndWxhcidzIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAvLyA8Zm9ybSBuYW1lPVwibXlGb3JtXCIgbm92YWxpZGF0ZSAuLi4+XG4gICAgICAgICAgICAvLyBvbiB5b3VyIGZvcm0ncyBpbnB1dHMsIHlvdSBtdXN0IGluY2x1ZGUgbmctbW9kZWwgYW5kIG5hbWU6IDxpbnB1dCBuZy1tb2RlbD1cImZpcnN0TmFtZVwiIG5hbWU9XCJteUZvcm0uZmlyc3QtbmFtZSBcIi4uLj5cbiAgICAgICAgICAgIC8vIHlvdXIgZm9ybSdzIHN1Ym1pdCBidXR0b24gc2hvdWxkIHVzZSBuZy1zdWJtaXQuXG4gICAgICAgICAgICAvLyB0byB2YWxpZGF0ZSBhbiBlbWFpbDogbmctY2xhc3M9XCJ7ICdlcnJvcic6IG15Rm9ybS5lbWFpbEFkZHJlc3MuJGludmFsaWQgfVwiXG5cbiAgICAgICAgICAgIC8vIGltcGxlbWVudGF0aW9uXG5cbiAgICAgICAgICAgIGZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQodXBkYXRlTG9nSW5TdGF0dXMpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVMb2dJblN0YXR1cyhhdXRoZW50aWNhdGVkVXNlcikge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ1cGRhdGVMb2dJblN0YXR1cyB0cmlnZ2VyZWRcIik7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImF1dGhlbnRpY2F0ZWRVc2VyIGlzOiBcIiwgYXV0aGVudGljYXRlZFVzZXIpO1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgaXM6IFwiLCBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgbG9nZ2VkSW5Vc2VyID0gYXV0aGVudGljYXRlZFVzZXI7XG4gICAgICAgICAgICAgICAgICAvLyAkcm9vdFNjb3BlLiRhcHBseSgpO1xuICAgICAgICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9nZXRMb2dnZWRJblVzZXIoKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImxvZ2dlZEluVXNlciBpczogXCIsIGxvZ2dlZEluVXNlcik7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gbG9nZ2VkSW5Vc2VyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBfbG9naW4oKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2UuYXV0aCgpLnNpZ25JbldpdGhQb3B1cChuZXcgZmlyZWJhc2UuYXV0aC5HaXRodWJBdXRoUHJvdmlkZXIoKSk7XG5cbiAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9nZ2VkSW5Vc2VyID0ge1xuICAgICAgICAgICAgICAgICAgLy8gICBuYW1lOiBpbnB1dE5hbWVcbiAgICAgICAgICAgICAgICAgIC8vIH07XG4gICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnB1dE5hbWUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvcm9vbXMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gX2xvZ291dCgpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmaXJlYmFzZS5hdXRoKCkuc2lnbk91dCgpO1xuXG4gICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvZ2dlZEluVXNlciA9IHt9O1xuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvd2VsY29tZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBfaXNMb2dnZWRJbigpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuKGxvZ2dlZEluVXNlcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9nZXRGaXJzdE5hbWUoKSB7XG4gICAgICAgICAgICAgICAgICBpZiAobG9nZ2VkSW5Vc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9nZ2VkSW5Vc2VyLmRpc3BsYXlOYW1lLnNwbGl0KCcgJylbMF07XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmZhY3RvcnkoXCJuYXZpZ2F0aW9uU2VydmljZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXROYXZpZ2F0aW9uOiBnZXROYXZpZ2F0aW9uLFxuICAgICAgICAgICAgYWRkTmF2aWdhdGlvbkl0ZW06IGFkZE5hdmlnYXRpb25JdGVtLFxuICAgICAgICAgICAgcmVtb3ZlTmF2aWdhdGlvbkl0ZW06IHJlbW92ZU5hdmlnYXRpb25JdGVtXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG5hdmlnYXRpb25JdGVtcyA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldE5hdmlnYXRpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdGlvbkl0ZW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkTmF2aWdhdGlvbkl0ZW0oaXRlbSkge1xuICAgICAgICAgICAgaWYgKCFuYXZpZ2F0aW9uSXRlbXMpIG5hdmlnYXRpb25JdGVtcyA9IFtdO1xuICAgICAgICAgICAgbmF2aWdhdGlvbkl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmVOYXZpZ2F0aW9uSXRlbShpdGVtKSB7XG4gICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbUluTmF2aWdhdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUluTmF2aWdhdGlvbi5pZCA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuZmFjdG9yeShcInJvb21TZXJ2aWNlXCIsIGZ1bmN0aW9uICgkaHR0cCwgYXBwbGljYXRpb25TZXR0aW5ncykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Um9vbXM6IGdldFJvb21zLFxuICAgICAgICAgICAgZ2V0Um9vbUJ5SWQ6IGdldFJvb21CeUlkLFxuICAgICAgICAgICAgZmV0Y2hSb29tc0Zyb21EQjogZmV0Y2hSb29tc0Zyb21EQixcbiAgICAgICAgICAgIHdyaXRlUm9vbVJlc2VydmF0aW9uOiB3cml0ZVJvb21SZXNlcnZhdGlvblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByb29tcyA9IG51bGw7XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Um9vbXMoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldFJvb21zIGlzOiBcIiwgZ2V0Um9vbXMpO1xuICAgICAgICAgICAgcmV0dXJuIHJvb21zO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Um9vbUJ5SWQoaWQpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChhcHBsaWNhdGlvblNldHRpbmdzLmdldEZpcmViYXNlUmVzdFVybChcInJvb21zLyR7aWR9XCIpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGRhdGEuaWQgPSBpZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gbGV0IHJvb21zQXJyYXkgPSBbXTtcbiAgICAgICAgICAgIC8vIGxldCBteVJvb20gPSBcIlwiO1xuICAgICAgICAgICAgLy8gcm9vbXNBcnJheS5wdXNoKHJvb21zKTtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBmb3IodmFyIGkgPSAwOyBpIDwgcm9vbXNBcnJheVswXS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gICAgIGlmKHJvb21zQXJyYXlbMF1baV0uaWQgPT09IHBhcnNlSW50KCRyb3V0ZVBhcmFtcy5pZCwgMTApKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgIG15Um9vbSA9IHJvb21zQXJyYXlbMF1baV0ubmFtZTtcbiAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAvLyByZXR1cm4gbXlSb29tO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZmV0Y2hSb29tc0Zyb21EQigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoYXBwbGljYXRpb25TZXR0aW5ncy5nZXRGaXJlYmFzZVJlc3RVcmwoXCJyb29tc1wiKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJvb21zKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvb21zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pZCA9IGtleTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSb29tIHVwZGF0ZWQgZHVyaW5nIGZldGNoXCIsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcm9vbXM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHdyaXRlUm9vbVJlc2VydmF0aW9uKGlkLCByZXNlcnZhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGdldFJvb21CeUlkKGlkKS50aGVuKGZ1bmN0aW9uIChyb29tKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoYXBwbGljYXRpb25TZXR0aW5ncy5nZXRGaXJlYmFzZVJlc3RVcmwoXCJyb29tcy9cIiArIGlkICsgXCIvcmVzZXJ2YXRpb25zL1wiICsgZ2V0Um9vbURhdGVLZXkoKSksIHJlc2VydmF0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Um9vbURhdGVLZXkoZGF0ZSkge1xuICAgICAgICAgICAgdmFyIGRhdGVLZXkgPSB2b2lkIDA7XG5cbiAgICAgICAgICAgIGRhdGVLZXkgPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkudG9EYXRlU3RyaW5nKCkgOiBuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpO1xuXG4gICAgICAgICAgICBkYXRlS2V5ID0gZGF0ZUtleS5yZXBsYWNlKC8gL2csIFwiXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGF0ZUtleTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuLy8gKGZ1bmN0aW9uKCkge1xuLy9cbi8vICAgLy8gSSBhbSBkb2luZyBhc3luYyB3b3JrXG4vLyAgIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKG1lc3NhZ2UpIHtcbi8vICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7IC8vZm9yIEFuZ3VsYXIsIHVzZSBcInJldHVybiBuZXcgJHEuLi5cIlxuLy8gICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbi8vICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4vL1xuLy8gICAgICAgICByZXNvbHZlKFwiT0ssIEknbSBkb25lIHdpdGggXCIgKyBtZXNzYWdlKTtcbi8vICAgICAgIH0sIDMwMDApO1xuLy8gICAgIH0pO1xuLy8gICB9XG4vL1xuLy8gICBjb25uZWN0VG9TZXJ2ZXIoKVxuLy8gICAgIC50aGVuKGxvZ2luVXNlcilcbi8vICAgICAudGhlbihkb3dubG9hZFByb2ZpbGUpXG4vLyAgICAgLnRoZW4obWFrZUFNZXNzYWdlKVxuLy9cbi8vXG4vLyAgIGZ1bmN0aW9uIGNvbm5lY3RUb1NlcnZlcigpIHtcbi8vICAgICByZXR1cm4gc2VuZE1lc3NhZ2UoXCJDb25uZWN0IHRvIHNlcnZlclwiKTtcbi8vICAgfVxuLy9cbi8vICAgZnVuY3Rpb24gbG9naW5Vc2VyKCkge1xuLy8gICAgIHJldHVybiBzZW5kTWVzc2FnZShcIkxvZ2dpbmcgaW4gdXNlclwiKTtcbi8vICAgfVxuLy9cbi8vICAgZnVuY3Rpb24gZG93bmxvYWRQcm9maWxlKCkge1xuLy8gICAgIHJldHVybiBzZW5kTWVzc2FnZShcIkRvd25sb2FkaW5nIHVzZXIgcHJvZmlsZVwiKTtcbi8vICAgfVxuLy9cbi8vICAgZnVuY3Rpb24gbWFrZUFNZXNzYWdlKHJlc3VsdHMpIHtcbi8vICAgICByZXR1cm4gc2VuZE1lc3NhZ2UocmVzdWx0cyk7XG4vLyAgIH1cbi8vIH0oKSk7XG5cInVzZSBzdHJpY3RcIjtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwiZXhlcmNpc2VPbmVDb250cm9sbGVyXCIsIGZ1bmN0aW9uICgkcm91dGVQYXJhbXMsIGVzKSB7XG4gICAgLy8gaW5qZWN0XG4gICAgdGhpcy5lcyA9IGVzOyAvLyBhc3NpZ25pbmcgZXMgdG8gdGhlIGNvbnRyb2xsZXIgYXMgYSBtZW1iZXJcblxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb250cm9sbGVyKFwiZXhlcmNpc2VUd29Db250cm9sbGVyXCIsIGZ1bmN0aW9uICgkcm91dGVQYXJhbXMsIGVzKSB7XG4gICAgLy8gaW5qZWN0XG4gICAgdGhpcy5lcyA9IGVzOyAvLyBhc3NpZ25pbmcgZXMgdG8gdGhlIGNvbnRyb2xsZXIgYXMgYSBtZW1iZXJcblxuXG4gICAgdGhpcy50aXRsZSA9IFwiRXhlcmNpc2UgMlwiO1xuXG4gICAgdmFyIF9wb3NzaWJsZUNvbG9ycyA9IFt7XG4gICAgICBuYW1lOiBcIkJyb3duXCIsXG4gICAgICBoZXg6IFwiI0E1MkEyQVwiXG4gICAgfSwge1xuICAgICAgbmFtZTogXCJCbHVlXCIsXG4gICAgICBoZXg6IFwiIzAwMDBGRlwiXG4gICAgfSwge1xuICAgICAgbmFtZTogXCJHYWluc2Jvcm9cIixcbiAgICAgIGhleDogXCIjRENEQ0RDXCJcbiAgICB9XTtcblxuICAgIGZ1bmN0aW9uIF9nZXRSYW5kb21Db2xvckZyb21Db2xsZWN0aW9uKCkge1xuICAgICAgdmFyIHJhbmRvbUNvbG9yID0gX3Bvc3NpYmxlQ29sb3JzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIF9wb3NzaWJsZUNvbG9ycy5sZW5ndGgpXTtcblxuICAgICAgcmV0dXJuIHJhbmRvbUNvbG9yO1xuICAgIH1cblxuICAgIHRoaXMub2JqZWN0QXJyYXkgPSBbXTtcblxuICAgIHRoaXMuX2NyZWF0ZU9iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciByZXR1cm5PYmplY3QgPSB7XG4gICAgICAgIG5hbWU6IFwiT2JqXCIgKyAodGhpcy5vYmplY3RBcnJheS5sZW5ndGggKyAxKSxcbiAgICAgICAgY2xpY2tDb3VudDogMCxcbiAgICAgICAgY29sb3I6IF9nZXRSYW5kb21Db2xvckZyb21Db2xsZWN0aW9uKClcbiAgICAgIH07XG4gICAgICByZXR1cm4gcmV0dXJuT2JqZWN0O1xuICAgIH07XG5cbiAgICB0aGlzLmNvbnRyb2xsZXJJbml0T2JqZWN0ID0gdGhpcy5vYmplY3RBcnJheTtcblxuICAgIHRoaXMuYWRkTmV3T2JqZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5vYmplY3RBcnJheS5wdXNoKHRoaXMuX2NyZWF0ZU9iamVjdCgpKTtcbiAgICB9O1xuXG4gICAgdmFyIG9yaWdpbmFsQnV0dG9uVGV4dCA9IFwiQnV0dG9uIHRleHRcIjtcblxuICAgIHRoaXMuYnV0dG9uVGV4dCA9IG9yaWdpbmFsQnV0dG9uVGV4dDtcblxuICAgIHRoaXMuYnV0dG9uTW91c2VFbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuYnV0dG9uVGV4dCA9IFwiUm9sbGVkIG92ZXJcIjtcbiAgICB9O1xuXG4gICAgdGhpcy5idXR0b25SZXNldENsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5idXR0b25UZXh0ID0gb3JpZ2luYWxCdXR0b25UZXh0O1xuICAgIH07XG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbXBvbmVudChcImd3TG9naW5cIiwge1xuICAgIHRlbXBsYXRlVXJsOiBcInd3dy9hcHAvY29tcG9uZW50cy9sb2dpbi9sb2dpbi5odG1cIixcbiAgICBjb250cm9sbGVyOiBcImxvZ2luQ29tcG9uZW50Q29udHJvbGxlclwiLFxuICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCJcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29udHJvbGxlcihcImxvZ2luQ29tcG9uZW50Q29udHJvbGxlclwiLCBmdW5jdGlvbiAobG9naW5TZXJ2aWNlLCAkc2NvcGUpIHtcbiAgICB0aGlzLmxvZ2luU2VydmljZSA9IGxvZ2luU2VydmljZTtcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwibmF2aWdhdGlvblwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL25hdmlnYXRpb24vbmF2aWdhdGlvbi5odG1sXCIsXG4gICAgY29udHJvbGxlcjogXCJuYXZpZ2F0aW9uQ29udHJvbGxlclwiLFxuICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCJcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29udHJvbGxlcihcIm5hdmlnYXRpb25Db250cm9sbGVyXCIsIGZ1bmN0aW9uICgkbG9jYXRpb24sIGxvZ2luU2VydmljZSwgbmF2aWdhdGlvblNlcnZpY2UsIHJvb21TZXJ2aWNlLCAkc2NvcGUpIHtcbiAgICB0aGlzLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBhZGQgdG8gZWFjaCBjb250cm9sbGVyXG4gICAgICB0aGlzLmxvZ2luU2VydmljZSA9IGxvZ2luU2VydmljZTtcbiAgICAgIHRoaXMubmF2aWdhdGlvblNlcnZpY2UgPSBuYXZpZ2F0aW9uU2VydmljZTtcbiAgICAgIHRoaXMucm9vbVNlcnZpY2UgPSByb29tU2VydmljZTtcbiAgICAgIHRoaXMuaXNJdGVtQWN0aXZlID0gaXNJdGVtQWN0aXZlO1xuXG4gICAgICAvLyBhZGQgd2VsY29tZSBsaW5rXG4gICAgICB2YXIgd2VsY29tZUl0ZW0gPSB7XG4gICAgICAgIHRpdGxlOiBcIldlbGNvbWVcIixcbiAgICAgICAgdXJsOiBcIi93ZWxjb21lXCJcbiAgICAgIH07XG5cbiAgICAgIG5hdmlnYXRpb25TZXJ2aWNlLmFkZE5hdmlnYXRpb25JdGVtKHdlbGNvbWVJdGVtKTtcblxuICAgICAgLy8gYWRkIHJvb20gbGlua3NcbiAgICAgIC8vIHRoaXMgaXMgc3luY2hyb25vdXMgZm9yIG5vd1xuICAgICAgcm9vbVNlcnZpY2UuZmV0Y2hSb29tc0Zyb21EQigpLnRoZW4oZnVuY3Rpb24gKHJvb21zKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJvb21zKTtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvb21zLCBmdW5jdGlvbiAob2JqZWN0VmFsdWUsIG9iamVjdEtleSkge1xuICAgICAgICAgIHZhciBpdGVtVG9BZGQgPSB7XG4gICAgICAgICAgICB0aXRsZTogb2JqZWN0VmFsdWUubmFtZSxcbiAgICAgICAgICAgIHVybDogXCIvcm9vbS9cIiArIG9iamVjdEtleVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBuYXZpZ2F0aW9uU2VydmljZS5hZGROYXZpZ2F0aW9uSXRlbShpdGVtVG9BZGQpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBpc0l0ZW1BY3RpdmUodmlld0xvY2F0aW9uKSB7XG4gICAgICAgIHJldHVybiB2aWV3TG9jYXRpb24gPT09ICRsb2NhdGlvbi5wYXRoKCk7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29tcG9uZW50KFwiclJvb21cIiwge1xuICAgIHRlbXBsYXRlVXJsOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tcy9yb29tLmh0bVwiLFxuICAgIGNvbnRyb2xsZXI6IFwicm9vbUNvbXBvbmVudENvbnRyb2xsZXJcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY3RybFwiXG4gIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29udHJvbGxlcihcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uIChyb29tU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2dlcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tU2VydmljZSA9IHJvb21TZXJ2aWNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW5kVGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNlcnZlUmVhc29ucyA9IFtcIkJpcnRoZGF5XCIsIFwiQ29uZmVyZW5jZVwiLCBcIkludGVydmlld1wiLCBcIlNjcnVtIE1lZXRpbmdcIiwgXCJIb25leW1vb25cIl07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFzdGVyID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tU3VibWlzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3RhcnRcIiwgdGhpcy5zdGFydFRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlbmRcIiwgdGhpcy5lbmRUaW1lKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRUaW1lID49IHRoaXMuZW5kVGltZSkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IHRpbWUgaW52YWxpZFwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubXlGb3JtLiRpbnZhbGlkKSByZXR1cm4gYWxlcnQoXCJNZXNzYWdlIGZyb20gY29udHJvbGxlcjogZm9ybSBpbnZhbGlkXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tU2VydmljZS53cml0ZVJvb21SZXNlcnZhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIlJvb20gc3VibWl0dGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xufSkod2luZG93LmFuZ3VsYXIpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoYW5ndWxhcikge1xuICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJyb29tc0NvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKGxvZ2luU2VydmljZSkge1xuICAgIHRoaXMubG9naW5TZXJ2aWNlID0gbG9naW5TZXJ2aWNlO1xuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb21wb25lbnQoXCJyUm9vbVJlc2VydmF0aW9uRm9ybVwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb21zL3Jvb20tcmVzZXJ2YXRpb24tZm9ybS9yb29tLXJlc2VydmF0aW9uLWZvcm0uaHRtXCIsXG4gICAgY29udHJvbGxlcjogXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29udHJvbGxlclwiLFxuICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCIsXG4gICAgcmVxdWlyZToge1xuICAgICAgcGFyZW50Q29udHJvbGxlcjogXCJeclJvb21cIiAvLyBtYWtlcyB0aGUgcGFyZW50IGNvbnRyb2xsZXIgYSBtZW1iZXIgb2YgdGhpcyBjb250cm9sbGVyXG4gICAgfVxuICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpLmNvbnRyb2xsZXIoXCJyb29tUmVzZXJ2YXRpb25Gb3JtQ29udHJvbGxlclwiLCBmdW5jdGlvbiAocm9vbVNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdnZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbVNlcnZpY2UgPSByb29tU2VydmljZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZFRpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXJ2ZVJlYXNvbnMgPSBbXCJCaXJ0aGRheVwiLCBcIkNvbmZlcmVuY2VcIiwgXCJJbnRlcnZpZXdcIiwgXCJTY3J1bSBNZWV0aW5nXCIsIFwiSG9uZXltb29uXCJdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc3RlciA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbVN1Ym1pc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInN0YXJ0XCIsIHRoaXMuc3RhcnRUaW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZW5kXCIsIHRoaXMuZW5kVGltZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGhpcyBpczogXCIsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0aGlzLnJvb20gaXM6IFwiLCB0aGlzLnJvb20pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYoIXRoaXMucm9vbS5yZXNlcnZhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy5yb29tLnJlc2VydmF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm15Rm9ybSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0VGltZSA+PSB0aGlzLmVuZFRpbWUpIHJldHVybiBhbGVydChcIk1lc3NhZ2UgZnJvbSBjb250cm9sbGVyOiB0aW1lIGludmFsaWRcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm15Rm9ybS4kaW52YWxpZCkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IGZvcm0gaW52YWxpZFwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJSb29tIHN1Ym1pdHRlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcblwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgYW5ndWxhci5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKS5jb21wb25lbnQoXCJyUm9vbVJlc2VydmF0aW9uTGlzdFwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb21zL3Jvb20tcmVzZXJ2YXRpb24tbGlzdC9yb29tLXJlc2VydmF0aW9uLWxpc3QuaHRtXCIsXG4gICAgY29udHJvbGxlcjogXCJyb29tUmVzZXJ2YXRpb25MaXN0Q29udHJvbGxlclwiLFxuICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCJcbiAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG5cInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAgICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwbGljYXRpb25cIikuY29udHJvbGxlcihcInJvb21SZXNlcnZhdGlvbkxpc3RDb250cm9sbGVyXCIsIGZ1bmN0aW9uICgpIHt9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTsiLCIoIGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuXHRhbmd1bGFyXHJcblx0XHQubW9kdWxlKFwiYXBwbGljYXRpb25cIiwgW1wibmdSb3V0ZVwiXSlcclxuXHJcblx0XHQuY29uc3RhbnQoXCJhcHBsaWNhdGlvblNldHRpbmdzXCIsIHtcclxuXHRcdFx0YXBwbGljYXRpb25UaXRsZSA6IFwiUm9vbXlcIixcclxuXHJcblx0XHRcdGdldEZpcmViYXNlUmVzdFVybCA6IGZ1bmN0aW9uKHN1ZmZpeCkge1xyXG5cdFx0XHRcdGNvbnN0IHByZWZpeCA9IFwiaHR0cHM6Ly9jb25mZGVjb25mbGljdG9yLmZpcmViYXNlaW8uY29tL1wiO1xyXG5cdFx0XHRcdGNvbnN0IGV4dCA9IFwiLmpzb25cIjtcclxuXHJcblx0XHRcdFx0cmV0dXJuIHByZWZpeCArIHN1ZmZpeCArIGV4dDtcclxuXHRcdFx0fSxcclxuXHJcblx0XHRcdGdldEltYWdlUGF0aCA6IGZ1bmN0aW9uKGZpbGUpIHtcclxuXHRcdFx0XHRyZXR1cm4gXCJ3d3cvYXNzZXRzL2ltYWdlcy8ke2ZpbGV9XCI7XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0LmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHJvdXRlUHJvdmlkZXIpIHtcclxuXHRcdFx0JGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuXHRcdFx0JHJvdXRlUHJvdmlkZXJcclxuXHRcdFx0XHRcdC53aGVuKFwiL2xvZ2luXCIsIHtcclxuXHRcdFx0XHRcdFx0dGVtcGxhdGVVcmwgICAgOiAnd3d3L2FwcC9yb3V0ZXMvbG9naW5wYWdlL2xvZ2lucGFnZS5odG0nLFxyXG5cdFx0XHRcdFx0XHQvL2NvbnRyb2xsZXIgICA6IFwiY29udHJvbGxlclwiLFxyXG5cdFx0XHRcdFx0XHQvL2NvbnRyb2xsZXJBcyA6IFwiY3RybFwiLFxyXG5cdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdC53aGVuKFwiL3Jvb20vOmlkXCIsIHtcclxuXHRcdFx0XHRcdFx0cmVzb2x2ZSAgICAgICAgOiB7XHJcblx0XHRcdFx0XHRcdFx0aXNMb2dnZWRJbiAgIDogZnVuY3Rpb24obG9naW5TZXJ2aWNlKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gIWxvZ2luU2VydmljZS5pc0xvZ2dlZEluKCkgPyAkbG9jYXRpb24ucGF0aChcIi93ZWxjb21lXCIpIDogdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH0sXHJcblx0XHRcdFx0XHRcdHRlbXBsYXRlICAgICAgIDogJzxyLXJvb20+PC9yLXJvb20+JyxcclxuXHRcdFx0XHRcdFx0Ly9jb250cm9sbGVyICAgOiBcImNvbnRyb2xsZXJcIixcclxuXHRcdFx0XHRcdFx0Ly9jb250cm9sbGVyQXMgOiBcImN0cmxcIixcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQud2hlbihcIi93ZWxjb21lXCIsIHtcclxuXHRcdFx0XHRcdFx0dGVtcGxhdGVVcmwgICAgOiAnd3d3L2FwcC9yb3V0ZXMvd2VsY29tZS93ZWxjb21lLmh0bScsXHJcblx0XHRcdFx0XHRcdC8vY29udHJvbGxlciAgIDogXCJjb250cm9sbGVyXCIsXHJcblx0XHRcdFx0XHRcdC8vY29udHJvbGxlckFzIDogXCJjdHJsXCIsXHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0Lm90aGVyd2lzZSh7XHJcblx0XHRcdFx0XHRcdHJlZGlyZWN0VG86XCIvd2VsY29tZVwiXHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdH0pO1xyXG59ICh3aW5kb3cuYW5ndWxhcikpO1xyXG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG4gICAgLnNlcnZpY2UoXCJsb2dpblNlcnZpY2VcIiwgZnVuY3Rpb24oJHJvb3RTY29wZSkge1xyXG4gICAgICAvLyBwdWJsaWMgQVBJXHJcbiAgICAgIHRoaXMubG9naW4gPSBfbG9naW47XHJcbiAgICAgIHRoaXMubG9nb3V0ID0gX2xvZ291dDtcclxuICAgICAgdGhpcy5pc0xvZ2dlZEluID0gX2lzTG9nZ2VkSW47XHJcbiAgICAgIHRoaXMuZ2V0TG9nZ2VkSW5Vc2VyID0gX2dldExvZ2dlZEluVXNlcjtcclxuICAgICAgdGhpcy5nZXRGaXJzdE5hbWUgPSBfZ2V0Rmlyc3ROYW1lO1xyXG5cclxuICAgICAgbGV0IGxvZ2dlZEluVXNlciA9IG51bGw7XHJcbiAgICAgIGxldCBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgPSBudWxsO1xyXG5cclxuICAgICAgLy8gRk9STSBDUkVBVElPTiBBTkQgVkFMSURBVElPTiBJTlNUUlVDVElPTlNcclxuICAgICAgLy8geW91IG11c3QgbmFtZSBhIGZvcm0gZm9yIGFuZ3VsYXIgdG8gcmVjb2duaXplIGl0IDxmb3JtIG5hbWU9XCJteUZvcm1cIiAuLi4+XHJcbiAgICAgIC8vIHlvdSBtdXN0IGFsc28gaW5jbHVkZSBcIm5vdmFsaWRhdGVcIi4gdGhpcyB0dXJucyBvZmYgeW91ciBicm93c2VyJ3MgdmFsaWRhdGlvbi4gaXQgd2lsbCBjb25mbGljdCB3aXRoIGFuZ3VsYXIncyB2YWxpZGF0aW9uLlxyXG4gICAgICAvLyA8Zm9ybSBuYW1lPVwibXlGb3JtXCIgbm92YWxpZGF0ZSAuLi4+XHJcbiAgICAgIC8vIG9uIHlvdXIgZm9ybSdzIGlucHV0cywgeW91IG11c3QgaW5jbHVkZSBuZy1tb2RlbCBhbmQgbmFtZTogPGlucHV0IG5nLW1vZGVsPVwiZmlyc3ROYW1lXCIgbmFtZT1cIm15Rm9ybS5maXJzdC1uYW1lIFwiLi4uPlxyXG4gICAgICAvLyB5b3VyIGZvcm0ncyBzdWJtaXQgYnV0dG9uIHNob3VsZCB1c2Ugbmctc3VibWl0LlxyXG4gICAgICAvLyB0byB2YWxpZGF0ZSBhbiBlbWFpbDogbmctY2xhc3M9XCJ7ICdlcnJvcic6IG15Rm9ybS5lbWFpbEFkZHJlc3MuJGludmFsaWQgfVwiXHJcblxyXG4gICAgICAvLyBpbXBsZW1lbnRhdGlvblxyXG5cclxuICAgICAgZmlyZWJhc2UuYXV0aCgpLm9uQXV0aFN0YXRlQ2hhbmdlZCh1cGRhdGVMb2dJblN0YXR1cyk7XHJcblxyXG4gICAgICBmdW5jdGlvbiB1cGRhdGVMb2dJblN0YXR1cyhhdXRoZW50aWNhdGVkVXNlcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlTG9nSW5TdGF0dXMgdHJpZ2dlcmVkXCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiYXV0aGVudGljYXRlZFVzZXIgaXM6IFwiLCBhdXRoZW50aWNhdGVkVXNlcik7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJub3RpZnlDb250cm9sbGVyQ2FsbGJhY2sgaXM6IFwiLCBub3RpZnlDb250cm9sbGVyQ2FsbGJhY2spO1xyXG4gICAgICAgIGxvZ2dlZEluVXNlciA9IGF1dGhlbnRpY2F0ZWRVc2VyO1xyXG4gICAgICAgIC8vICRyb290U2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIF9nZXRMb2dnZWRJblVzZXIoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJsb2dnZWRJblVzZXIgaXM6IFwiLCBsb2dnZWRJblVzZXIpO1xyXG4gICAgICAgIHJldHVybiBsb2dnZWRJblVzZXI7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIF9sb2dpbigpIHtcclxuICAgICAgICByZXR1cm4gZmlyZWJhc2UuYXV0aCgpLnNpZ25JbldpdGhQb3B1cChuZXcgZmlyZWJhc2UuYXV0aC5HaXRodWJBdXRoUHJvdmlkZXIoKSk7XHJcblxyXG4gICAgICAgIC8vIHRoaXMubG9nZ2VkSW5Vc2VyID0ge1xyXG4gICAgICAgIC8vICAgbmFtZTogaW5wdXROYW1lXHJcbiAgICAgICAgLy8gfTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vIHRoaXMuaW5wdXROYW1lID0gbnVsbDtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvcm9vbXMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gX2xvZ291dCgpIHtcclxuICAgICAgICByZXR1cm4gZmlyZWJhc2UuYXV0aCgpLnNpZ25PdXQoKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy5sb2dnZWRJblVzZXIgPSB7fTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vICRsb2NhdGlvbi5wYXRoKCcvd2VsY29tZScpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBfaXNMb2dnZWRJbigpIHtcclxuICAgICAgICByZXR1cm4gQm9vbGVhbihsb2dnZWRJblVzZXIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBfZ2V0Rmlyc3ROYW1lKCkge1xyXG4gICAgICAgIGlmIChsb2dnZWRJblVzZXIpIHtcclxuICAgICAgICByZXR1cm4gbG9nZ2VkSW5Vc2VyLmRpc3BsYXlOYW1lLnNwbGl0KCcgJylbMF07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbn0od2luZG93LmFuZ3VsYXIpKTtcclxuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcclxuXHJcbiAgICAgICAgLmZhY3RvcnkoXCJuYXZpZ2F0aW9uU2VydmljZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBnZXROYXZpZ2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgYWRkTmF2aWdhdGlvbkl0ZW0sXHJcbiAgICAgICAgICAgICAgICByZW1vdmVOYXZpZ2F0aW9uSXRlbVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbGV0IG5hdmlnYXRpb25JdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TmF2aWdhdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0aW9uSXRlbXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZE5hdmlnYXRpb25JdGVtKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGlmICghbmF2aWdhdGlvbkl0ZW1zKSBuYXZpZ2F0aW9uSXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25JdGVtcy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiByZW1vdmVOYXZpZ2F0aW9uSXRlbShpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMuZm9yRWFjaCgoaXRlbUluTmF2aWdhdGlvbiwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUluTmF2aWdhdGlvbi5pZCA9PT0gaXRlbS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uSXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXHJcblxyXG4gICAgICAgIC5mYWN0b3J5KFwicm9vbVNlcnZpY2VcIiwgZnVuY3Rpb24oJGh0dHAsIGFwcGxpY2F0aW9uU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGdldFJvb21zLFxyXG4gICAgICAgICAgICAgICAgZ2V0Um9vbUJ5SWQsXHJcbiAgICAgICAgICAgICAgICBmZXRjaFJvb21zRnJvbURCLFxyXG4gICAgICAgICAgICAgICAgd3JpdGVSb29tUmVzZXJ2YXRpb25cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGxldCByb29tcyA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRSb29tcygpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0Um9vbXMgaXM6IFwiLCBnZXRSb29tcyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcm9vbXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJvb21CeUlkKGlkKSB7XHJcbiAgICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChhcHBsaWNhdGlvblNldHRpbmdzLmdldEZpcmViYXNlUmVzdFVybChcInJvb21zLyR7aWR9XCIpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuZGF0YSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQgPSBpZDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGxldCByb29tc0FycmF5ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbGV0IG15Um9vbSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcm9vbXNBcnJheS5wdXNoKHJvb21zKTtcclxuICAgICAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGZvcih2YXIgaSA9IDA7IGkgPCByb29tc0FycmF5WzBdLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGlmKHJvb21zQXJyYXlbMF1baV0uaWQgPT09IHBhcnNlSW50KCRyb3V0ZVBhcmFtcy5pZCwgMTApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBteVJvb20gPSByb29tc0FycmF5WzBdW2ldLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIG15Um9vbTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZmV0Y2hSb29tc0Zyb21EQigpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KGFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0RmlyZWJhc2VSZXN0VXJsKFwicm9vbXNcIikpXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5kYXRhKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocm9vbXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyb29tcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pZCA9IGtleTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSb29tIHVwZGF0ZWQgZHVyaW5nIGZldGNoXCIsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm9vbXM7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVSb29tUmVzZXJ2YXRpb24oaWQsIHJlc2VydmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGdldFJvb21CeUlkKGlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocm9vbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KFxyXG4gICAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uU2V0dGluZ3MuZ2V0RmlyZWJhc2VSZXN0VXJsKGByb29tcy8ke2lkfS9yZXNlcnZhdGlvbnMvJHtnZXRSb29tRGF0ZUtleSgpfWApLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uXHJcbiAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJvb21EYXRlS2V5KGRhdGUpIHtcclxuICAgICAgICAgICAgICBsZXQgZGF0ZUtleTtcclxuXHJcbiAgICAgICAgICAgICAgZGF0ZUtleSA9IGRhdGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICA/IG5ldyBEYXRlKGRhdGUpLnRvRGF0ZVN0cmluZygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgOiBuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpO1xyXG5cclxuICAgICAgICAgICAgICBkYXRlS2V5ID0gZGF0ZUtleS5yZXBsYWNlKC8gL2csIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICByZXR1cm4gZGF0ZUtleTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXHJcbiAgICAuY29udHJvbGxlcihcImV4ZXJjaXNlT25lQ29udHJvbGxlclwiLCBmdW5jdGlvbigkcm91dGVQYXJhbXMsIGVzKSB7IC8vIGluamVjdFxyXG4gICAgICB0aGlzLmVzID0gZXM7IC8vIGFzc2lnbmluZyBlcyB0byB0aGUgY29udHJvbGxlciBhcyBhIG1lbWJlclxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICB9KTtcclxufSh3aW5kb3cuYW5ndWxhcikpO1xyXG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG4gICAgLmNvbnRyb2xsZXIoXCJleGVyY2lzZVR3b0NvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJHJvdXRlUGFyYW1zLCBlcykgeyAvLyBpbmplY3RcclxuICAgICAgdGhpcy5lcyA9IGVzOyAvLyBhc3NpZ25pbmcgZXMgdG8gdGhlIGNvbnRyb2xsZXIgYXMgYSBtZW1iZXJcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgIHRoaXMudGl0bGUgPSBcIkV4ZXJjaXNlIDJcIjtcclxuXHJcbiAgICAgIGNvbnN0IF9wb3NzaWJsZUNvbG9ycyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiBcIkJyb3duXCIsXHJcbiAgICAgICAgICBoZXg6IFwiI0E1MkEyQVwiXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiBcIkJsdWVcIixcclxuICAgICAgICAgIGhleDogXCIjMDAwMEZGXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIG5hbWU6IFwiR2FpbnNib3JvXCIsXHJcbiAgICAgICAgICBoZXg6IFwiI0RDRENEQ1wiXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgZnVuY3Rpb24gX2dldFJhbmRvbUNvbG9yRnJvbUNvbGxlY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc3QgcmFuZG9tQ29sb3IgPSBfcG9zc2libGVDb2xvcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogX3Bvc3NpYmxlQ29sb3JzLmxlbmd0aCldO1xyXG5cclxuICAgICAgICByZXR1cm4gcmFuZG9tQ29sb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMub2JqZWN0QXJyYXkgPSBbXTtcclxuXHJcbiAgICAgIHRoaXMuX2NyZWF0ZU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHJldHVybk9iamVjdCA9IHtcclxuICAgICAgICAgIG5hbWU6IFwiT2JqXCIgKyAodGhpcy5vYmplY3RBcnJheS5sZW5ndGggKyAxKSxcclxuICAgICAgICAgIGNsaWNrQ291bnQ6IDAsXHJcbiAgICAgICAgICBjb2xvcjogX2dldFJhbmRvbUNvbG9yRnJvbUNvbGxlY3Rpb24oKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHJldHVybk9iamVjdDtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRoaXMuY29udHJvbGxlckluaXRPYmplY3QgPSB0aGlzLm9iamVjdEFycmF5O1xyXG5cclxuICAgICAgdGhpcy5hZGROZXdPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB0aGlzLm9iamVjdEFycmF5LnB1c2godGhpcy5fY3JlYXRlT2JqZWN0KCkpO1xyXG4gICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICBsZXQgb3JpZ2luYWxCdXR0b25UZXh0ID0gXCJCdXR0b24gdGV4dFwiO1xyXG5cclxuICAgICAgdGhpcy5idXR0b25UZXh0ID0gb3JpZ2luYWxCdXR0b25UZXh0O1xyXG5cclxuICAgICAgdGhpcy5idXR0b25Nb3VzZUVudGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5idXR0b25UZXh0ID0gXCJSb2xsZWQgb3ZlclwiO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgdGhpcy5idXR0b25SZXNldENsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5idXR0b25UZXh0ID0gb3JpZ2luYWxCdXR0b25UZXh0O1xyXG4gICAgICB9O1xyXG5cclxuICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIiggZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG4gICAgLmNvbXBvbmVudChcImd3TG9naW5cIiwge1xyXG4gICAgICB0ZW1wbGF0ZVVybDogXCJ3d3cvYXBwL2NvbXBvbmVudHMvbG9naW4vbG9naW4uaHRtXCIsXHJcbiAgICAgIGNvbnRyb2xsZXI6IFwibG9naW5Db21wb25lbnRDb250cm9sbGVyXCIsXHJcbiAgICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCIsXHJcbiAgICB9KTtcclxufSh3aW5kb3cuYW5ndWxhcikpO1xyXG4iLCIoIGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcclxuICAgIC5jb250cm9sbGVyKFwibG9naW5Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uKGxvZ2luU2VydmljZSwgJHNjb3BlKSB7XHJcbiAgICAgIHRoaXMubG9naW5TZXJ2aWNlID0gbG9naW5TZXJ2aWNlO1xyXG4gICAgfSk7XHJcbn0od2luZG93LmFuZ3VsYXIpKTtcclxuIiwiKCBmdW5jdGlvbihhbmd1bGFyKSB7XHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXHJcbiAgICAuY29tcG9uZW50KFwibmF2aWdhdGlvblwiLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiBcInd3dy9hcHAvY29tcG9uZW50cy9uYXZpZ2F0aW9uL25hdmlnYXRpb24uaHRtbFwiLFxyXG4gICAgICBjb250cm9sbGVyOiBcIm5hdmlnYXRpb25Db250cm9sbGVyXCIsXHJcbiAgICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCIsXHJcbiAgICB9KTtcclxufSh3aW5kb3cuYW5ndWxhcikpO1xyXG4iLCIoIGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcclxuICAgIC5jb250cm9sbGVyKFwibmF2aWdhdGlvbkNvbnRyb2xsZXJcIiwgZnVuY3Rpb24oJGxvY2F0aW9uLCBsb2dpblNlcnZpY2UsIG5hdmlnYXRpb25TZXJ2aWNlLCByb29tU2VydmljZSwgJHNjb3BlKSB7XHJcbiAgICAgIHRoaXMuJG9uSW5pdCA9IGZ1bmN0aW9uKCkgeyAvLyBhZGQgdG8gZWFjaCBjb250cm9sbGVyXHJcbiAgICAgICAgdGhpcy5sb2dpblNlcnZpY2UgPSBsb2dpblNlcnZpY2U7XHJcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uU2VydmljZSA9IG5hdmlnYXRpb25TZXJ2aWNlO1xyXG4gICAgICAgIHRoaXMucm9vbVNlcnZpY2UgPSByb29tU2VydmljZTtcclxuICAgICAgICB0aGlzLmlzSXRlbUFjdGl2ZSA9IGlzSXRlbUFjdGl2ZTtcclxuXHJcbiAgICAgICAgLy8gYWRkIHdlbGNvbWUgbGlua1xyXG4gICAgICAgIGxldCB3ZWxjb21lSXRlbSA9IHtcclxuICAgICAgICAgIHRpdGxlOiBcIldlbGNvbWVcIixcclxuICAgICAgICAgIHVybCAgOiBcIi93ZWxjb21lXCJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBuYXZpZ2F0aW9uU2VydmljZS5hZGROYXZpZ2F0aW9uSXRlbSh3ZWxjb21lSXRlbSk7XHJcblxyXG4gICAgICAgIC8vIGFkZCByb29tIGxpbmtzXHJcbiAgICAgICAgLy8gdGhpcyBpcyBzeW5jaHJvbm91cyBmb3Igbm93XHJcbiAgICAgICAgcm9vbVNlcnZpY2UuZmV0Y2hSb29tc0Zyb21EQigpLnRoZW4ocm9vbXMgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2cocm9vbXMpO1xyXG4gICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJvb21zLCBmdW5jdGlvbihvYmplY3RWYWx1ZSwgb2JqZWN0S2V5KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1Ub0FkZCA9IHtcclxuICAgICAgICAgICAgICB0aXRsZSA6IG9iamVjdFZhbHVlLm5hbWUsXHJcbiAgICAgICAgICAgICAgdXJsICAgOiBgL3Jvb20vJHtvYmplY3RLZXl9YFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbmF2aWdhdGlvblNlcnZpY2UuYWRkTmF2aWdhdGlvbkl0ZW0oaXRlbVRvQWRkKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0l0ZW1BY3RpdmUodmlld0xvY2F0aW9uKSB7XHJcbiAgICAgICAgICByZXR1cm4gKHZpZXdMb2NhdGlvbiA9PT0gJGxvY2F0aW9uLnBhdGgoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIiggZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG4gICAgLmNvbXBvbmVudChcInJSb29tXCIsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb21zL3Jvb20uaHRtXCIsXHJcbiAgICAgIGNvbnRyb2xsZXI6IFwicm9vbUNvbXBvbmVudENvbnRyb2xsZXJcIixcclxuICAgICAgY29udHJvbGxlckFzOiBcImN0cmxcIixcclxuICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG5cclxuICAgICAgICAuY29udHJvbGxlcihcInJvb21Db21wb25lbnRDb250cm9sbGVyXCIsIGZ1bmN0aW9uIChyb29tU2VydmljZSkge1xyXG4gICAgICAgICAgICB0aGlzLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICBkZWJ1Z2dlcjtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvb21TZXJ2aWNlID0gcm9vbVNlcnZpY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW5kVGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2VydmVSZWFzb25zID0gW1xyXG4gICAgICAgICAgICAgICAgICAgIFwiQmlydGhkYXlcIixcclxuICAgICAgICAgICAgICAgICAgICBcIkNvbmZlcmVuY2VcIixcclxuICAgICAgICAgICAgICAgICAgICBcIkludGVydmlld1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiU2NydW0gTWVldGluZ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiSG9uZXltb29uXCJcclxuICAgICAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXN0ZXIgPSB7fTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucm9vbVN1Ym1pc3Npb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3RhcnRcIiwgdGhpcy5zdGFydFRpbWUpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlbmRcIiwgdGhpcy5lbmRUaW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFydFRpbWUgPj0gdGhpcy5lbmRUaW1lKSByZXR1cm4gYWxlcnQoXCJNZXNzYWdlIGZyb20gY29udHJvbGxlcjogdGltZSBpbnZhbGlkXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm15Rm9ybS4kaW52YWxpZCkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IGZvcm0gaW52YWxpZFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICByb29tU2VydmljZS53cml0ZVJvb21SZXNlcnZhdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGFsZXJ0KFwiUm9vbSBzdWJtaXR0ZWRcIik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbn0od2luZG93LmFuZ3VsYXIpKTtcclxuIiwiKCBmdW5jdGlvbihhbmd1bGFyKSB7XHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXHJcbiAgICAuY29udHJvbGxlcihcInJvb21zQ29udHJvbGxlclwiLCBmdW5jdGlvbihsb2dpblNlcnZpY2UpIHtcclxuICAgICAgdGhpcy5sb2dpblNlcnZpY2UgPSBsb2dpblNlcnZpY2U7XHJcbiAgICB9KTtcclxufSh3aW5kb3cuYW5ndWxhcikpO1xyXG4iLCIoIGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKFwiYXBwbGljYXRpb25cIilcclxuICAgIC5jb21wb25lbnQoXCJyUm9vbVJlc2VydmF0aW9uRm9ybVwiLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiBcInd3dy9hcHAvY29tcG9uZW50cy9yb29tcy9yb29tLXJlc2VydmF0aW9uLWZvcm0vcm9vbS1yZXNlcnZhdGlvbi1mb3JtLmh0bVwiLFxyXG4gICAgICBjb250cm9sbGVyOiBcInJvb21SZXNlcnZhdGlvbkZvcm1Db250cm9sbGVyXCIsXHJcbiAgICAgIGNvbnRyb2xsZXJBczogXCJjdHJsXCIsXHJcbiAgICAgIHJlcXVpcmU6IHtcclxuICAgICAgICBwYXJlbnRDb250cm9sbGVyOiBcIl5yUm9vbVwiIC8vIG1ha2VzIHRoZSBwYXJlbnQgY29udHJvbGxlciBhIG1lbWJlciBvZiB0aGlzIGNvbnRyb2xsZXJcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbn0od2luZG93LmFuZ3VsYXIpKTtcclxuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZShcImFwcGxpY2F0aW9uXCIpXHJcblxyXG4gICAgICAgIC5jb250cm9sbGVyKFwicm9vbVJlc2VydmF0aW9uRm9ybUNvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKHJvb21TZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucm9vbVNlcnZpY2UgPSByb29tU2VydmljZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbmRUaW1lLnNldEhvdXJzKDAsIDAsIDAsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXJ2ZVJlYXNvbnMgPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgXCJCaXJ0aGRheVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiQ29uZmVyZW5jZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiSW50ZXJ2aWV3XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJTY3J1bSBNZWV0aW5nXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJIb25leW1vb25cIlxyXG4gICAgICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1hc3RlciA9IHt9O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yb29tU3VibWlzc2lvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdGFydFwiLCB0aGlzLnN0YXJ0VGltZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVuZFwiLCB0aGlzLmVuZFRpbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGhpcyBpczogXCIsIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0aGlzLnJvb20gaXM6IFwiLCB0aGlzLnJvb20pO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYoIXRoaXMucm9vbS5yZXNlcnZhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgdGhpcy5yb29tLnJlc2VydmF0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMubXlGb3JtKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFydFRpbWUgPj0gdGhpcy5lbmRUaW1lKSByZXR1cm4gYWxlcnQoXCJNZXNzYWdlIGZyb20gY29udHJvbGxlcjogdGltZSBpbnZhbGlkXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm15Rm9ybS4kaW52YWxpZCkgcmV0dXJuIGFsZXJ0KFwiTWVzc2FnZSBmcm9tIGNvbnRyb2xsZXI6IGZvcm0gaW52YWxpZFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBhbGVydChcIlJvb20gc3VibWl0dGVkXCIpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIiggZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG4gICAgLmNvbXBvbmVudChcInJSb29tUmVzZXJ2YXRpb25MaXN0XCIsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6IFwid3d3L2FwcC9jb21wb25lbnRzL3Jvb21zL3Jvb20tcmVzZXJ2YXRpb24tbGlzdC9yb29tLXJlc2VydmF0aW9uLWxpc3QuaHRtXCIsXHJcbiAgICAgIGNvbnRyb2xsZXI6IFwicm9vbVJlc2VydmF0aW9uTGlzdENvbnRyb2xsZXJcIixcclxuICAgICAgY29udHJvbGxlckFzOiBcImN0cmxcIixcclxuICAgIH0pO1xyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoXCJhcHBsaWNhdGlvblwiKVxyXG5cclxuICAgICAgICAuY29udHJvbGxlcihcInJvb21SZXNlcnZhdGlvbkxpc3RDb250cm9sbGVyXCIsIGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgfSk7XHJcbn0od2luZG93LmFuZ3VsYXIpKTtcclxuIl19
